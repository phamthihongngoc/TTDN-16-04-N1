<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="0">
        
        <!-- Category -->
        <record id="module_category_van_ban" model="ir.module.category">
            <field name="name">Quản lý văn bản</field>
            <field name="description">Phân quyền cho module quản lý văn bản</field>
            <field name="sequence">20</field>
        </record>

        <!-- Group: Nhân viên soạn thảo -->
        <record id="group_nhan_vien_soan_thao" model="res.groups">
            <field name="name">Nhân viên soạn thảo</field>
            <field name="category_id" ref="module_category_van_ban"/>
            <field name="comment">Tạo và chỉnh sửa văn bản nháp</field>
        </record>

        <!-- Group: Trưởng phòng duyệt -->
        <record id="group_truong_phong_duyet" model="res.groups">
            <field name="name">Trưởng phòng duyệt</field>
            <field name="category_id" ref="module_category_van_ban"/>
            <field name="implied_ids" eval="[(4, ref('group_nhan_vien_soan_thao'))]"/>
            <field name="comment">Duyệt nội dung văn bản</field>
        </record>

        <!-- Group: Giám đốc ký -->
        <record id="group_giam_doc_ky" model="res.groups">
            <field name="name">Giám đốc ký</field>
            <field name="category_id" ref="module_category_van_ban"/>
            <field name="implied_ids" eval="[(4, ref('group_truong_phong_duyet'))]"/>
            <field name="comment">Phê duyệt và ký văn bản</field>
        </record>

        <!-- Group: Quản trị văn bản -->
        <record id="group_quan_tri_van_ban" model="res.groups">
            <field name="name">Quản trị văn bản</field>
            <field name="category_id" ref="module_category_van_ban"/>
            <field name="implied_ids" eval="[(4, ref('group_giam_doc_ky'))]"/>
            <field name="users" eval="[(4, ref('base.user_admin'))]"/>
            <field name="comment">Toàn quyền quản lý văn bản</field>
        </record>

        <!-- Record Rules -->
        
        <!-- Nhân viên chỉ xem văn bản của mình -->
        <record id="van_ban_rule_nhan_vien" model="ir.rule">
            <field name="name">Văn bản: Nhân viên xem của mình</field>
            <field name="model_id" ref="model_van_ban"/>
            <field name="domain_force">[('nguoi_tao_id.user_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('group_nhan_vien_soan_thao'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Trưởng phòng xem tất cả -->
        <record id="van_ban_rule_truong_phong" model="ir.rule">
            <field name="name">Văn bản: Trưởng phòng xem tất cả</field>
            <field name="model_id" ref="model_van_ban"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_truong_phong_duyet'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Quản trị toàn quyền -->
        <record id="van_ban_rule_quan_tri" model="ir.rule">
            <field name="name">Văn bản: Quản trị toàn quyền</field>
            <field name="model_id" ref="model_van_ban"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_quan_tri_van_ban'))]"/>
        </record>

        <!-- OCR Security: Only admins can create/modify OCR records -->
        <record id="van_ban_ocr_rule_admin_only" model="ir.rule">
            <field name="name">OCR: Chỉ admin truy cập</field>
            <field name="model_id" ref="model_van_ban_ocr"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_quan_tri_van_ban'))]"/>
        </record>

        <!-- AI Features Security: Restrict AI analysis to authorized users -->
        <record id="van_ban_ai_rule_restricted" model="ir.rule">
            <field name="name">AI Features: Giới hạn truy cập</field>
            <field name="model_id" ref="model_van_ban"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_truong_phong_duyet')), (4, ref('group_giam_doc_ky')), (4, ref('group_quan_tri_van_ban'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Workflow Template Security: Only admins can modify workflows -->
        <record id="workflow_template_rule_admin" model="ir.rule">
            <field name="name">Workflow Template: Chỉ admin</field>
            <field name="model_id" ref="model_workflow_template"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_quan_tri_van_ban'))]"/>
        </record>

        <!-- Audit Trail Security: Read-only for all authorized users -->
        <record id="lich_su_van_ban_rule_readonly" model="ir.rule">
            <field name="name">Lịch sử: Chỉ đọc</field>
            <field name="model_id" ref="model_lich_su_van_ban"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_nhan_vien_soan_thao')), (4, ref('group_truong_phong_duyet')), (4, ref('group_giam_doc_ky')), (4, ref('group_quan_tri_van_ban'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

    </data>
</odoo>

<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Tree View -->
    <record id="view_bang_luong_tree" model="ir.ui.view">
        <field name="name">bang_luong.tree</field>
        <field name="model">bang_luong</field>
        <field name="arch" type="xml">
            <tree string="B·∫£ng l∆∞∆°ng"
                  decoration-info="trang_thai=='chua_duyet'" 
                  decoration-success="trang_thai=='da_duyet'"
                  decoration-muted="trang_thai=='da_thanh_toan'"
                  create="false">
                <header>
                    <button name="action_tao_bang_luong_thang_nay" string="‚ûï T·∫°o b·∫£ng l∆∞∆°ng th√°ng n√†y" 
                            type="object" class="btn-primary"/>
                </header>
                <field name="nhan_vien_id"/>
                <field name="thang"/>
                <field name="nam"/>
                <field name="so_cong_thuc_te" string="S·ªë c√¥ng"/>
                <field name="so_lan_di_tre" optional="show" decoration-warning="so_lan_di_tre &gt; 0"/>
                <field name="so_lan_ve_som" optional="show" decoration-warning="so_lan_ve_som &gt; 0"/>
                <field name="so_cong_chuan" optional="hide"/>
                <field name="luong_co_ban" widget="monetary" optional="hide"/>
                <field name="luong_theo_cong" widget="monetary" optional="hide"/>
                <field name="thuong" widget="monetary" sum="T·ªïng th∆∞·ªüng" decoration-success="1"/>
                <field name="phat_di_tre_ve_som" widget="monetary" optional="show" sum="T·ªïng ph·∫°t tr·ªÖ/s·ªõm" decoration-warning="1"/>
                <field name="phat" widget="monetary" sum="T·ªïng ph·∫°t kh√°c" decoration-danger="1"/>
                <field name="luong_nhan" widget="monetary" sum="T·ªïng l∆∞∆°ng" decoration-bf="1" decoration-info="1"/>
                <field name="trang_thai"/>
                <field name="currency_id" invisible="1"/>
            </tree>
        </field>
    </record>

    <!-- Form View -->
    <record id="view_bang_luong_form" model="ir.ui.view">
        <field name="name">bang_luong.form</field>
        <field name="model">bang_luong</field>
        <field name="arch" type="xml">
            <form string="B·∫£ng l∆∞∆°ng">
                <header>
                    <button name="action_tinh_lai_luong" string="üîÑ T√≠nh l·∫°i" type="object" 
                            class="btn-secondary"/>
                    <button name="action_duyet" string="‚úÖ Duy·ªát" type="object" 
                            class="oe_highlight"/>
                    <button name="action_thanh_toan" string="üí∞ Thanh to√°n" type="object" 
                            class="oe_highlight"/>
                    <field name="trang_thai" widget="statusbar" 
                           statusbar_visible="chua_duyet,da_duyet,da_thanh_toan"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <h1 class="d-flex">
                            <field name="nhan_vien_id" placeholder="Ch·ªçn nh√¢n vi√™n..." 
                                   required="1" options="{'no_create': True}" class="oe_inline"/>
                        </h1>
                        <h3 class="text-muted">
                            Th√°ng <field name="thang" required="1" class="oe_inline" style="width: 80px;"/>
                            / <field name="nam" required="1" class="oe_inline" style="width: 100px;"/>
                        </h3>
                    </div>
                    
                    <group>
                        <group string="üìä Th√¥ng Tin C√¥ng">
                            <field name="so_cong_thuc_te" string="S·ªë c√¥ng th·ª±c t·∫ø"
                                   readonly="1" class="text-primary font-weight-bold"/>
                            <field name="so_cong_chuan" string="S·ªë c√¥ng chu·∫©n"
                                   readonly="1" class="text-muted"/>
                            <separator string="‚ö†Ô∏è Th·ªëng k√™ vi ph·∫°m" colspan="2"/>
                            <field name="so_lan_di_tre" readonly="1" class="text-warning"/>
                            <field name="so_lan_ve_som" readonly="1" class="text-warning"/>
                            <field name="phat_di_tre_ve_som" readonly="1" widget="monetary"
                                   options="{'currency_field': 'currency_id'}"
                                   class="text-danger font-weight-bold"/>
                        </group>
                        
                        <group string="üíµ Chi Ti·∫øt L∆∞∆°ng">
                            <field name="luong_co_ban" readonly="1" widget="monetary"
                                   options="{'currency_field': 'currency_id'}"/>
                            <field name="luong_theo_cong" readonly="1" widget="monetary"
                                   options="{'currency_field': 'currency_id'}"/>
                            <separator string="ƒêi·ªÅu ch·ªânh" colspan="2"/>
                            <field name="thuong" widget="monetary"
                                   options="{'currency_field': 'currency_id'}"/>
                            <field name="phat" widget="monetary"
                                   options="{'currency_field': 'currency_id'}" 
                                   help="Ph·∫°t kh√°c (kh√¥ng bao g·ªìm ƒëi tr·ªÖ/v·ªÅ s·ªõm)"/>
                            <field name="currency_id" invisible="1"/>
                        </group>
                    </group>
                    
                    <!-- T·ªïng l∆∞∆°ng n·ªïi b·∫≠t -->
                    <group>
                        <group></group>
                        <group>
                            <label for="luong_nhan" string="T·ªïng L∆∞∆°ng Nh·∫≠n" 
                                   class="font-weight-bold" style="font-size: 16px;"/>
                            <field name="luong_nhan" readonly="1" widget="monetary"
                                   options="{'currency_field': 'currency_id'}"
                                   class="text-success font-weight-bold"
                                   style="font-size: 28px;"/>
                        </group>
                    </group>
                    
                    <group>
                        <field name="ghi_chu" nolabel="1" 
                               placeholder="Ghi ch√∫ v·ªÅ b·∫£ng l∆∞∆°ng..."/>
                    </group>
                    
                    <!-- C√¥ng th·ª©c t√≠nh l∆∞∆°ng -->
                    <div class="alert alert-success mt-3" role="alert">
                        <h5 class="alert-heading">üìê C√¥ng th·ª©c t√≠nh l∆∞∆°ng:</h5>
                        <p class="mb-0">
                            <strong>L∆∞∆°ng nh·∫≠n</strong> = (S·ªë c√¥ng √ó L∆∞∆°ng c∆° b·∫£n) √∑ S·ªë c√¥ng chu·∫©n + Th∆∞·ªüng - Ph·∫°t
                        </p>
                    </div>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Pivot View -->
    <record id="view_bang_luong_pivot" model="ir.ui.view">
        <field name="name">bang_luong.pivot</field>
        <field name="model">bang_luong</field>
        <field name="arch" type="xml">
            <pivot string="Th·ªëng k√™ l∆∞∆°ng">
                <field name="nhan_vien_id" type="row"/>
                <field name="thang" type="col"/>
                <field name="luong_nhan" type="measure"/>
            </pivot>
        </field>
    </record>

    <!-- Graph View -->
    <record id="view_bang_luong_graph" model="ir.ui.view">
        <field name="name">bang_luong.graph</field>
        <field name="model">bang_luong</field>
        <field name="arch" type="xml">
            <graph string="Bi·ªÉu ƒë·ªì l∆∞∆°ng" type="bar">
                <field name="nhan_vien_id"/>
                <field name="luong_nhan" type="measure"/>
            </graph>
        </field>
    </record>

    <!-- Search View -->
    <record id="view_bang_luong_search" model="ir.ui.view">
        <field name="name">bang_luong.search</field>
        <field name="model">bang_luong</field>
        <field name="arch" type="xml">
            <search string="T√¨m ki·∫øm b·∫£ng l∆∞∆°ng">
                <field name="nhan_vien_id"/>
                <field name="thang"/>
                <field name="nam"/>
                
                <filter string="Th√°ng n√†y" name="this_month" 
                        domain="[('thang', '=', str(context_today().month)), ('nam', '=', context_today().year)]"/>
                <filter string="NƒÉm nay" name="this_year" 
                        domain="[('nam', '=', context_today().year)]"/>
                
                <separator/>
                <filter string="‚è≥ Ch∆∞a duy·ªát" name="chua_duyet" 
                        domain="[('trang_thai', '=', 'chua_duyet')]"/>
                <filter string="‚úÖ ƒê√£ duy·ªát" name="da_duyet" 
                        domain="[('trang_thai', '=', 'da_duyet')]"/>
                <filter string="üí∞ ƒê√£ thanh to√°n" name="da_thanh_toan" 
                        domain="[('trang_thai', '=', 'da_thanh_toan')]"/>
                
                <group expand="0" string="Nh√≥m theo">
                    <filter string="Nh√¢n vi√™n" name="group_nhan_vien" 
                            context="{'group_by': 'nhan_vien_id'}"/>
                    <filter string="Th√°ng" name="group_thang" 
                            context="{'group_by': 'thang'}"/>
                    <filter string="NƒÉm" name="group_nam" 
                            context="{'group_by': 'nam'}"/>
                    <filter string="Tr·∫°ng th√°i" name="group_trang_thai" 
                            context="{'group_by': 'trang_thai'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Action -->
    <record id="action_bang_luong" model="ir.actions.act_window">
        <field name="name">B·∫£ng L∆∞∆°ng</field>
        <field name="res_model">bang_luong</field>
        <field name="view_mode">tree,form,pivot,graph</field>
        <field name="context">{'search_default_this_month': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                T·∫°o b·∫£ng l∆∞∆°ng m·ªõi
            </p>
            <p>
                Click <b>T·∫°o</b> ƒë·ªÉ t√≠nh l∆∞∆°ng cho nh√¢n vi√™n theo th√°ng.<br/>
                H·ªá th·ªëng s·∫Ω t·ª± ƒë·ªông t√≠nh to√°n d·ª±a tr√™n s·ªë c√¥ng ƒë√£ ch·∫•m.
            </p>
        </field>
    </record>
</odoo>

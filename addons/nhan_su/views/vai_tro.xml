<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Form view cho Vai tr√≤ -->
        <record id="view_vai_tro_form" model="ir.ui.view">
            <field name="name">vai_tro.form</field>
            <field name="model">vai_tro</field>
            <field name="arch" type="xml">
                <form string="Vai tr√≤ nh√¢n s·ª±">
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <button name="toggle_active" type="object" 
                                    class="oe_stat_button" icon="fa-archive">
                                <field name="active" widget="boolean_button" 
                                       options='{"terminology": "archive"}'/>
                            </button>
                        </div>
                        
                        <div class="oe_title">
                            <label for="ten_vai_tro" class="oe_edit_only"/>
                            <h1>
                                <field name="ten_vai_tro" placeholder="VD: Tr∆∞·ªüng ph√≤ng kinh doanh..."/>
                            </h1>
                            <h3>
                                <field name="ma_vai_tro" placeholder="M√£ vai tr√≤ (VD: TP_KD)" 
                                       class="text-uppercase"/>
                            </h3>
                        </div>
                        
                        <group>
                            <group>
                                <field name="thu_tu"/>
                                <field name="so_nhan_vien" string="S·ªë nh√¢n vi√™n"/>
                                <field name="group_id" groups="base.group_no_one"/>
                            </group>
                            <group>
                                <field name="mo_ta" placeholder="M√¥ t·∫£ vai tr√≤ v√† tr√°ch nhi·ªám..." colspan="2"/>
                            </group>
                        </group>
                        
                        <notebook>
                            <!-- Tab Quy·ªÅn vƒÉn b·∫£n -->
                            <page string="üìÑ Quy·ªÅn x·ª≠ l√Ω vƒÉn b·∫£n" name="quyen_van_ban">
                                <group>
                                    <group string="Quy·ªÅn c∆° b·∫£n">
                                        <field name="quyen_soan_thao"/>
                                        <field name="quyen_duyet"/>
                                        <field name="quyen_phe_duyet"/>
                                    </group>
                                    <group string="Quy·ªÅn m·ªü r·ªông">
                                        <field name="quyen_huy"/>
                                        <field name="quyen_xem_tat_ca"/>
                                    </group>
                                </group>
                                <separator string="üí° H∆∞·ªõng d·∫´n"/>
                                <div class="alert alert-info" role="status" aria-live="polite">
                                    <ul>
                                        <li><b>So·∫°n th·∫£o:</b> T·∫°o v√† ch·ªânh s·ª≠a vƒÉn b·∫£n m·ªõi</li>
                                        <li><b>Duy·ªát:</b> X√©t duy·ªát vƒÉn b·∫£n (c·∫•p tr∆∞·ªüng ph√≤ng)</li>
                                        <li><b>Ph√™ duy·ªát:</b> Ph√™ duy·ªát cu·ªëi c√πng (c·∫•p gi√°m ƒë·ªëc)</li>
                                        <li><b>H·ªßy:</b> H·ªßy b·ªè vƒÉn b·∫£n ƒë√£ ƒë∆∞·ª£c duy·ªát</li>
                                        <li><b>Xem t·∫•t c·∫£:</b> Xem to√†n b·ªô vƒÉn b·∫£n trong h·ªá th·ªëng</li>
                                    </ul>
                                </div>
                            </page>
                            
                            <!-- Tab Quy·ªÅn kh√°ch h√†ng -->
                            <page string="üë• Quy·ªÅn qu·∫£n l√Ω kh√°ch h√†ng" name="quyen_khach_hang">
                                <group>
                                    <group>
                                        <field name="quyen_them_khach_hang"/>
                                        <field name="quyen_phan_cong_khach_hang"/>
                                    </group>
                                    <group>
                                        <field name="quyen_xem_khach_hang_tat_ca"/>
                                    </group>
                                </group>
                                <separator string="üí° H∆∞·ªõng d·∫´n"/>
                                <div class="alert alert-info" role="status" aria-live="polite">
                                    <ul>
                                        <li><b>Th√™m kh√°ch h√†ng:</b> T·∫°o m·ªõi h·ªì s∆° kh√°ch h√†ng</li>
                                        <li><b>Ph√¢n c√¥ng:</b> G√°n kh√°ch h√†ng cho nh√¢n vi√™n ph·ª• tr√°ch</li>
                                        <li><b>Xem t·∫•t c·∫£:</b> Xem to√†n b·ªô kh√°ch h√†ng (kh√¥ng ch·ªâ c·ªßa m√¨nh)</li>
                                    </ul>
                                </div>
                            </page>
                            
                            <!-- Tab Quy·ªÅn qu·∫£n tr·ªã -->
                            <page string="‚öôÔ∏è Quy·ªÅn qu·∫£n tr·ªã" name="quyen_quan_tri">
                                <group>
                                    <field name="quyen_quan_ly_nhan_su"/>
                                    <field name="quyen_phan_quyen"/>
                                </group>
                                <separator string="üí° H∆∞·ªõng d·∫´n"/>
                                <div class="alert alert-warning" role="status" aria-live="polite">
                                    <strong>C·∫£nh b√°o:</strong> C√°c quy·ªÅn n√†y ch·ªâ d√†nh cho qu·∫£n tr·ªã vi√™n h·ªá th·ªëng.
                                    <ul>
                                        <li><b>Qu·∫£n l√Ω nh√¢n s·ª±:</b> Th√™m/s·ª≠a/x√≥a nh√¢n vi√™n</li>
                                        <li><b>Ph√¢n quy·ªÅn:</b> G√°n vai tr√≤ v√† quy·ªÅn h·∫°n cho nh√¢n vi√™n</li>
                                    </ul>
                                </div>
                            </page>
                            
                            <!-- Tab Danh s√°ch nh√¢n vi√™n -->
                            <page string="üë§ Nh√¢n vi√™n" name="nhan_vien">
                                <field name="nhan_vien_ids" mode="tree">
                                    <tree>
                                        <field name="ma_dinh_danh"/>
                                        <field name="ten_nv"/>
                                        <field name="chuc_vu"/>
                                        <field name="phong_ban"/>
                                        <field name="email"/>
                                        <field name="trang_thai_lam_viec" widget="badge"/>
                                    </tree>
                                </field>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- Tree view cho Vai tr√≤ -->
        <record id="view_vai_tro_tree" model="ir.ui.view">
            <field name="name">vai_tro.tree</field>
            <field name="model">vai_tro</field>
            <field name="arch" type="xml">
                <tree string="Danh s√°ch vai tr√≤">
                    <field name="thu_tu" widget="handle"/>
                    <field name="ma_vai_tro" decoration-bf="1"/>
                    <field name="ten_vai_tro" decoration-bf="1"/>
                    <field name="so_nhan_vien" sum="T·ªïng NV"/>
                    <field name="quyen_soan_thao" widget="boolean_toggle"/>
                    <field name="quyen_duyet" widget="boolean_toggle"/>
                    <field name="quyen_phe_duyet" widget="boolean_toggle"/>
                    <field name="quyen_xem_tat_ca" widget="boolean_toggle" optional="hide"/>
                    <field name="quyen_quan_ly_nhan_su" widget="boolean_toggle" optional="hide"/>
                    <field name="active" widget="boolean_toggle"/>
                </tree>
            </field>
        </record>

        <!-- Kanban view cho Vai tr√≤ -->
        <record id="view_vai_tro_kanban" model="ir.ui.view">
            <field name="name">vai_tro.kanban</field>
            <field name="model">vai_tro</field>
            <field name="arch" type="xml">
                <kanban class="o_kanban_mobile">
                    <field name="id"/>
                    <field name="ten_vai_tro"/>
                    <field name="ma_vai_tro"/>
                    <field name="so_nhan_vien"/>
                    <field name="quyen_soan_thao"/>
                    <field name="quyen_duyet"/>
                    <field name="quyen_phe_duyet"/>
                    <templates>
                        <t t-name="kanban-box">
                            <div class="oe_kanban_global_click">
                                <div class="o_kanban_record_top">
                                    <div class="o_kanban_record_headings">
                                        <strong class="o_kanban_record_title">
                                            <span><field name="ten_vai_tro"/></span>
                                        </strong>
                                        <small class="text-muted">
                                            <field name="ma_vai_tro"/>
                                        </small>
                                    </div>
                                    <span class="badge badge-pill">
                                        <i class="fa fa-users" title="S·ªë nh√¢n vi√™n"/> <field name="so_nhan_vien"/> NV
                                    </span>
                                </div>
                                <div class="o_kanban_record_body">
                                    <div>
                                        <t t-if="record.quyen_soan_thao.raw_value">
                                            <span class="badge badge-info">üìù So·∫°n th·∫£o</span>
                                        </t>
                                        <t t-if="record.quyen_duyet.raw_value">
                                            <span class="badge badge-warning">‚úÖ Duy·ªát</span>
                                        </t>
                                        <t t-if="record.quyen_phe_duyet.raw_value">
                                            <span class="badge badge-success">‚úîÔ∏è Ph√™ duy·ªát</span>
                                        </t>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <!-- Search view -->
        <record id="view_vai_tro_search" model="ir.ui.view">
            <field name="name">vai_tro.search</field>
            <field name="model">vai_tro</field>
            <field name="arch" type="xml">
                <search string="T√¨m ki·∫øm vai tr√≤">
                    <field name="ten_vai_tro"/>
                    <field name="ma_vai_tro"/>
                    
                    <filter string="C√≥ quy·ªÅn duy·ªát" name="co_quyen_duyet" 
                            domain="[('quyen_duyet', '=', True)]"/>
                    <filter string="C√≥ quy·ªÅn ph√™ duy·ªát" name="co_quyen_phe_duyet" 
                            domain="[('quyen_phe_duyet', '=', True)]"/>
                    <separator/>
                    <filter string="ƒêang ho·∫°t ƒë·ªông" name="active" 
                            domain="[('active', '=', True)]"/>
                    <filter string="ƒê√£ l∆∞u tr·ªØ" name="archived" 
                            domain="[('active', '=', False)]"/>
                    
                    <group expand="0" string="Nh√≥m theo">
                        <filter string="Quy·ªÅn duy·ªát" name="group_quyen_duyet" 
                                context="{'group_by':'quyen_duyet'}"/>
                        <filter string="Quy·ªÅn ph√™ duy·ªát" name="group_quyen_phe_duyet" 
                                context="{'group_by':'quyen_phe_duyet'}"/>
                    </group>
                </search>
            </field>
        </record>

        <!-- Action -->
        <record id="action_vai_tro" model="ir.actions.act_window">
            <field name="name">Vai tr√≤ &amp; Quy·ªÅn h·∫°n</field>
            <field name="res_model">vai_tro</field>
            <field name="view_mode">tree,kanban,form</field>
            <field name="search_view_id" ref="view_vai_tro_search"/>
            <field name="context">{'search_default_active': 1}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    T·∫°o vai tr√≤ m·ªõi
                </p>
                <p>
                    ƒê·ªãnh nghƒ©a vai tr√≤ v√† ph√¢n quy·ªÅn cho nh√¢n vi√™n trong quy tr√¨nh x·ª≠ l√Ω vƒÉn b·∫£n.
                </p>
                <p>
                    <b>V√≠ d·ª•:</b> Nh√¢n vi√™n kinh doanh, Tr∆∞·ªüng ph√≤ng, Gi√°m ƒë·ªëc
                </p>
            </field>
        </record>

        <!-- Server action ƒë·ªÉ t·∫°o vai tr√≤ m·∫∑c ƒë·ªãnh -->
        <record id="action_server_create_default_roles" model="ir.actions.server">
            <field name="name">T·∫°o vai tr√≤ m·∫∑c ƒë·ªãnh</field>
            <field name="model_id" ref="model_vai_tro"/>
            <field name="state">code</field>
            <field name="code">model.create_default_roles()</field>
        </record>

    </data>
</odoo>
